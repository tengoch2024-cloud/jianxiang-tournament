<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>2025ç…å­ç›ƒå…¨åœ‹åœæ£‹å…¬é–‹è³½ï½œè³½ç¨‹ & åæ¬¡</title>
  <style>
    body { font-family: 'Noto Sans TC','Microsoft JhengHei',system-ui,sans-serif; margin:0; padding:10px; background:#f4f7f6; color:#333; }
    .container { max-width:900px; margin:0 auto; background:#fff; padding:15px; border-radius:8px; box-shadow:0 4px 12px rgba(0,0,0,.08); }
    h1 { color:#2c3e50; text-align:center; margin:0 0 16px; font-size:1.8em; line-height:1.2; }
    .update-info{ text-align:center; margin-bottom:12px; font-size:.85em; color:#7f8c8d; }
    .filter-section{ display:flex; gap:8px; align-items:center; justify-content:center; margin-bottom:12px; flex-wrap:wrap; }
    .filter-section select,.filter-section button{ padding:6px 10px; border:1px solid #ccc; border-radius:6px; font-size:.9em; background:#fff; cursor:pointer; }
    .filter-section button{ background:#2e7d32; color:#fff; border:none; }
    table{ width:100%; border-collapse:collapse; margin-bottom:12px; font-size:.9em; table-layout:auto; }
    th,td{ border:1px solid #ddd; padding:6px 4px; text-align:center; vertical-align:top; line-height:1.4; background:#fdfdfd; white-space:nowrap; word-break:keep-all; }
    th{ background:#4CAF50; color:#fff; font-weight:700; }
    thead th{ position:sticky; top:0; z-index:2; }
    tbody tr:nth-child(even) td{ background:#f9f9f9; }
    tbody tr:hover td{ background:#e6ffe6; }
    td.multiline{ white-space:pre-wrap; overflow-wrap:anywhere; word-break:break-word; } /* ä¿®æ­£ v3 ç‰ˆç¼ºå¤±çš„å¤§æ‹¬è™Ÿèˆ‡é‡è¤‡å±¬æ€§ */

    .important-note{ background:#fff3cd; border-left:5px solid #ffe082; padding:10px; margin-top:10px; border-radius:5px; color:#856404; font-size:.85em; }

    /* === AutoFit on mobileï¼ˆä¿®æ­£ï¼šé¿å…åå³ã€sticky æ¼‚æµ®ã€æ™‚é–“æ‹†å­—ï¼‰ === */
    @media (max-width:768px){
      body{ padding:8px; } .container{ padding:12px; } h1{ font-size:1.5em; }

      .table-autofit{ overflow:hidden; text-align:left; }
      .table-autofit .autofit-inner{
        display:inline-block;              /* é—œéµï¼šé¿å…ç¸®æ”¾å¾Œè¦–è¦ºå¯¬èˆ‡å¯¦éš›å¯¬ä¸ä¸€è‡´é€ æˆä½ç§» */
        transform-origin: top left;
        transform: scale(1);
      }

      /* sticky åœ¨ transform ç’°å¢ƒä¸‹å¸¸å¤±æ•ˆ â†’ æ‰‹æ©Ÿåœç”¨ stickyï¼Œé«”æ„Ÿæ›´ç©© */
      thead th{ position:static !important; }

      /* æ‰‹æ©ŸæŠŠå­—ç´š/å…§è·å†å°ä¸€é»ï¼ŒAutoFit æ›´å¥½å¡ä¸‹ */
      #scheduleTable th, #scheduleTable td{ font-size:12px; padding:4px 3px; }

      /* ä¿ç•™åæ¬¡æ¬„å¯æ›è¡Œï¼Œå…¶å®ƒæ¬„ä½ä¸æ‹†å­—ï¼ˆé¿å… 10:30 è¢«æ‹†ï¼‰ */
      #scheduleTable td.multiline{ white-space:pre-wrap !important; word-break:break-word; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ† 2025ç…å­ç›ƒå…¨åœ‹åœæ£‹å…¬é–‹è³½</h1>
    <div class="update-info">è«‹é‡æ–°æ•´ç†é é¢ä»¥æ›´æ–°è³½ç¨‹ï¼š<span id="lastUpdated"></span></div>

    <div class="filter-section">
      <label for="groupSelector">é¸æ“‡çµ„åˆ¥ï¼š</label>
      <select id="groupSelector"></select>
      <button id="refreshBtn" type="button">é‡æ–°è®€å–è³‡æ–™</button>
    </div>

    <!-- AutoFit wrapper -->
    <div id="tableFit" class="table-autofit">
      <div class="autofit-inner">
        <table id="scheduleTable">
          <thead>
            <tr>
              <th>çµ„åˆ¥</th>
              <th>ç¬¬ä¸€å ´</th>
              <th>ç¬¬äºŒå ´</th>
              <th>ç¬¬ä¸‰å ´</th>
              <th>ç¬¬å››å ´</th>
              <th>ç¬¬äº”å ´</th>
              <th>é ’çæ™‚é–“</th>
              <th>åæ¬¡å…¬ä½ˆ</th>
            </tr>
          </thead>
          <tbody><tr><td colspan="8">è³‡æ–™è¼‰å…¥ä¸­â€¦</td></tr></tbody>
        </table>
      </div>
    </div>

    <div id="statusMsg" class="update-info"></div>
    <div class="important-note"><strong>é‡è¦æç¤ºï¼š</strong> å„å ´æ¬¡é–‹è³½æ™‚é–“å°‡ä¾å¯¦éš›æ¯”è³½é€²åº¦å‹•æ…‹èª¿æ•´ï¼Œè«‹éš¨æ™‚ç•™æ„æœ¬é é¢æœ€æ–°å…¬å‘Šï¼é ’çæ™‚é–“ç‚ºé ä¼°ï¼Œå¯¦éš›é ’çæ™‚é–“è«‹ä¾ç¾å ´å»£æ’­ç‚ºæº–ã€‚åæ¬¡è³‡è¨Šå°‡æ–¼æ¯”è³½çµæŸå¾Œé™¸çºŒæ›´æ–°ã€‚</div>
  </div>

  <script>
  const DATA_URL = "./data.json";
  const RANK_FIELDS = ["åæ¬¡å…¬ä½ˆ","åæ¬¡å…¬å¸ƒ","å† è»","äºè»","å­£è»","æ®¿è»","å„ªå‹","ç¬¬ä¸€å","ç¬¬äºŒå","ç¬¬ä¸‰å","ç¬¬å››å","ç¬¬äº”å","ç¬¬å…­å","ç¬¬ä¸ƒå","ç¬¬å…«å","ç¬¬ä¹å","ç¬¬åå"];
  const defaultScheduleData = [{ group:"å…­æ®µçµ„" },{ group:"äº”æ®µçµ„" },{ group:"å››æ®µçµ„" }];
  const customGroupOrder = ["äº”å…­æ®µçµ„","ä¸€äºŒæ®µçµ„","ä¹™ä¸™çµ„","ä¸æˆŠçµ„","å…­æ®µçµ„","äº”æ®µçµ„","å››æ®µçµ„","ä¸‰æ®µçµ„","äºŒæ®µçµ„","åˆæ®µçµ„","ç”²çµ„","ä¹™çµ„","ä¸™çµ„","ä¸çµ„","æˆŠçµ„","å·±çµ„","åºšçµ„","è¾›Açµ„","è¾›Bçµ„","å…¥é–€Açµ„","å…¥é–€Bçµ„","å¹¼å…’çµ„"];
  let allData = [];

  function nowStr(){ return new Date().toLocaleString('zh-TW',{year:'numeric',month:'long',day:'numeric',hour:'2-digit',minute:'2-digit',second:'2-digit',hour12:false}); }
  function setStatus(msg){ document.getElementById('statusMsg').textContent = msg || ''; }
  function normalizeRankBlock(s){ if(!s) return ""; let t=String(s).trim(); if(!t) return ""; t=t.replace(/[ã€ï¼Œ,ï¼›;ï¼/]\s*/g,"\n"); t=t.replace(/\s*(å† è»|äºè»|å­£è»|æ®¿è»|å„ªå‹|ç¬¬[ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹å]+å)(?:\s*[:ï¼š])?/g,"\n$1ï¼š"); t=t.split("\n").map(x=>x.trim()).filter(Boolean).join("\n"); return t; }
  function buildRankValue(item){ const get=k=>(k in item&&item[k]!=null)?String(item[k]).trim():""; const single=normalizeRankBlock(get("åæ¬¡å…¬ä½ˆ"))||normalizeRankBlock(get("åæ¬¡å…¬å¸ƒ"))||normalizeRankBlock(get("ranksCombined")); if(single) return single; const lines=[]; for(const key of RANK_FIELDS){ if(key==="åæ¬¡å…¬ä½ˆ"||key==="åæ¬¡å…¬å¸ƒ") continue; const v=get(key); if(v) lines.push(`${key}ï¼š${v}`);} return lines.length?normalizeRankBlock(lines.join("\n")):"æœªå…¬å¸ƒ"; }
  function populateGroupDropdown(data){ const sel=document.getElementById("groupSelector"); const groups=Array.from(new Set(data.map(x=>x.group).filter(Boolean))); const known=customGroupOrder.filter(g=>groups.includes(g)); const unknown=groups.filter(g=>!customGroupOrder.includes(g)).sort((a,b)=>a.localeCompare(b,"zh-Hant")); sel.innerHTML=""; const optAll=document.createElement("option"); optAll.value="all"; optAll.textContent="é¡¯ç¤ºæ‰€æœ‰çµ„åˆ¥"; sel.appendChild(optAll); [...known,...unknown].forEach(g=>{ const o=document.createElement("option"); o.value=g; o.textContent=g; sel.appendChild(o); }); }
  function sortByCustomOrder(list){ const orderMap=new Map(customGroupOrder.map((g,i)=>[g,i])); return list.slice().sort((a,b)=>{ const ai=orderMap.has(a.group)?orderMap.get(a.group):9e9; const bi=orderMap.has(b.group)?orderMap.get(b.group):9e9; if(ai!==bi) return ai-bi; return a.group.localeCompare(b.group,"zh-Hant"); }); }
  function renderTable(dataToDisplay){ const tbody=document.querySelector("#scheduleTable tbody"); tbody.innerHTML=""; const list=dataToDisplay&&dataToDisplay.length?dataToDisplay:[]; if(!list.length){ tbody.innerHTML='<tr><td colspan="8">ç„¡ç¬¦åˆæ¢ä»¶çš„çµ„åˆ¥æ•¸æ“šã€‚</td></tr>'; document.getElementById("lastUpdated").textContent=nowStr(); return;} list.forEach(item=>{ const tr=document.createElement("tr"); tr.insertCell().textContent=item.group||""; tr.insertCell().textContent=item.round1||"æœªæ’å®š"; tr.insertCell().textContent=item.round2||"æœªæ’å®š"; tr.insertCell().textContent=item.round3||"æœªæ’å®š"; tr.insertCell().textContent=item.round4||"æœªæ’å®š"; tr.insertCell().textContent=item.round5||"æœªæ’å®š"; tr.insertCell().textContent=item.award||"æœªæ’å®š"; const tdRank=document.createElement("td"); tdRank.classList.add("multiline"); tdRank.innerHTML=buildRankValue(item).replace(/\n/g,"<br>"); tr.appendChild(tdRank); tbody.appendChild(tr); }); document.getElementById("lastUpdated").textContent=nowStr(); autoFitTable(); }
  function applyFilterAndRender(){ const selected=document.getElementById("groupSelector").value; let list=allData.slice(); if(selected!=="all") list=list.filter(x=>x.group===selected); list=sortByCustomOrder(list); renderTable(list); }
  async function loadData(){ setStatus("æ­£åœ¨è®€å–è³‡æ–™â€¦"); try{ const res=await fetch(DATA_URL,{cache:"no-store",headers:{"Accept":"application/json"}}); if(!res.ok) throw new Error("HTTP "+res.status); const data=await res.json(); allData=Array.isArray(data)?data:[]; if(!allData.length) throw new Error("ç©ºè³‡æ–™"); setStatus("è³‡æ–™æ›´æ–°å®Œæˆï¼ˆ"+nowStr()+"ï¼‰"); }catch(err){ console.error(err); allData=defaultScheduleData.slice(); setStatus("è®€å–å¤±æ•—ï¼šé¡¯ç¤ºé è¨­è³‡æ–™ã€‚"); }finally{ populateGroupDropdown(allData); applyFilterAndRender(); } }

  // AutoFit
  function autoFitTable(){
    const wrap=document.getElementById("tableFit");
    const inner=wrap?.querySelector(".autofit-inner");
    if(!wrap||!inner) return;
    const isMobile=window.matchMedia("(max-width: 768px)").matches;
    inner.style.transform="scale(1)";
    const wrapW=wrap.clientWidth;
    const contentW=inner.scrollWidth;
    let scale=isMobile?Math.min(1,wrapW/contentW):1;
    const MIN_SCALE=0.65; // é™ä½æœ€å°ç¸®æ”¾æ¯”ï¼Œé¿å…æ™‚é–“/è¡¨é ­è¢«æ‹†å­—
    scale=Math.max(scale,MIN_SCALE);
    inner.style.transform=`scale(${scale})`;
    requestAnimationFrame(()=>{
      wrap.style.height=(inner.getBoundingClientRect().height)+"px";
      wrap.style.width=wrap.clientWidth+"px"; // é¡å¤–ä¿éšªï¼Œé¿å… reflow é€ æˆæ°´å¹³ä½ç§»
    });
  }
  window.addEventListener("resize", autoFitTable);

  document.addEventListener("DOMContentLoaded", ()=>{
    document.getElementById("groupSelector").addEventListener("change", applyFilterAndRender);
    document.getElementById("refreshBtn").addEventListener("click", loadData);
    loadData();
  });
  </script>
</body>
</html>
